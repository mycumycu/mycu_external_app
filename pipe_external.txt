from X4_Python_Pipe_Server import Pipe_Server

# development options
# enable it to write received data to a file
isDevelopment = False
dataOutputFilename = "x4_external.json"
# Max message size in bytes. Should be the same as in node server env file
bufferSize = 262144

#pipe names
pipeInName = 'x4_external_game'
pipeOutName = 'x4_external_app'

def main(args):

    print('###: Starting X4 External App module')

    # start pipe to X4 game
    pipeIn = Pipe_Server(pipeInName, buffer_size = bufferSize)
    pipeIn.Connect()
    print('###: Created '+ pipeInName +' pipe.')

    # start pipe to Node.js
    pipeOut = Pipe_Server(pipeOutName, buffer_size = bufferSize)
    pipeOut.Connect()
    print('###: Created '+ pipeOutName +' pipe.')

    while 1:
        message = pipeIn.Read()

        # development purpose - save to file
        if isDevelopment:
            f = open(dataOutputFilename, "w", encoding='utf-8')
            f.write(message)
            f.close()

        pipeOut.Write(message)

